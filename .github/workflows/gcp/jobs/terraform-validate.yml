name: "Terraform Validate"

on:
  workflow_call:  # ‚úÖ Allows this job to be reusable from other workflows

jobs:
  terraform-validate:
    name: "üß™ Terraform Validate"
    runs-on: ubuntu-latest
    steps:
      - name: "üì• Checkout Repository"
        uses: actions/checkout@v4

      - name: "‚öôÔ∏è Setup Terraform"
        uses: hashicorp/setup-terraform@v2
        with:
          terraform_version: "1.5.0"   # ‚úÖ Pin version for stability

      - name: "‚öôÔ∏è Init Terraform (no backend)"
        run: terraform init -backend=false -input=false
        working-directory: Terraform-GCP

      - name: "üßπ Format Check"
        run: terraform fmt -check -recursive
        working-directory: Terraform-GCP

      - name: "üß™ Validate Configuration"
        run: terraform validate -no-color
        working-directory: Terraform-GCP

      - name: "üì¶ Save Validation Report"
        run: |
          mkdir -p reports
          terraform validate -json > reports/validate-report.json || true
        working-directory: Terraform-GCP

      - name: "‚¨ÜÔ∏è Upload Validation Report"
        uses: actions/upload-artifact@v3
        with:
          name: terraform-validate-report
          path: Infrastructure/Terraform-GCP/reports/validate-report.json
