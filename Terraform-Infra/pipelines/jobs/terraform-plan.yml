- job: terraform-plan
  displayName: "ğŸ“ Terraform Plan"
  dependsOn: terraform-init
  pool:
    vmImage: 'ubuntu-latest'
  steps:
    # -------------------------------
    # âœ… Ensure Terraform workspace
    # -------------------------------
    - script: |
        echo "ğŸ“‚ Switching to working directory: $(workingDirectory)"
        cd $(workingDirectory)

        PLAN_FILE="tfplan-$(environment)"
        VAR_FILE="env/terraform-$(environment).tfvars"

        if [ ! -f "$VAR_FILE" ]; then
          echo "âŒ Variable file not found: $VAR_FILE"
          exit 1
        fi

        echo "ğŸ“ Running terraform plan for environment: $(environment)"
        terraform plan \
          -out=$PLAN_FILE \
          -var-file="$VAR_FILE"

        echo "##vso[task.setvariable variable=PLAN_FILE;]$PLAN_FILE"
      displayName: "Generate Terraform Plan"
